<!DOCTYPE html>
<html lang="en">


    <style type="text/css">
    
    #img-container {
    min-width: 250px;
    min-height: 250px;
    padding: 13px;
    display: inline-block;
    border: 2px dashed black; 
    }
      
    .dropable-span {
    position: absolute;
    border: 2px dashed red;
    width: 100px;
    height: 100px;
    z-index: 100;
    background-color: coral;
        border-radius: 20px;
    }
       
    
#syn.fullscreen{
    z-index: 9999;
    background: #FFF;
    width: 100%; 
    height: 100%; 
    position: fixed; 
    top: 0; 
    left: 0; 
 }

/*
 #syn-container{ 
    height: 100%; 
    
 }


.syn_provided {


    border: 2px dashed blue;
    border-radius: 20px;

}
*/

.dragable-span {


    border: 2px dashed #15cf15;
    border-radius: 20px;


} 

    #dd-dropable 
    
    { 
    display: flex;
    flex-wrap:wrap;
    list-style-type: none;
    margin: 10px;
    padding: 10px; 
    min-height: 200px;
    border: 1px dotted #ccc;
    border-radius: 20px;
    }
    
    /*
    .syn-path-container {
    min-height: 200px;
    border: 3px dotted #ccc;
    border-radius: 20px;
    margin: 10px;
    padding: 10px;
    
    }
    */
    
    #dd-dropable li { margin: 3px 3px 3px 10px; padding: 1px; float: left; /*width: 100px; height: 90px;*/ font-size: 4em; text-align: center; }
    
    
    /*
    #reagents { list-style-type: none; margin: 0; padding: 0;  }
    #reagents li { margin: 3px 3px 3px 10px; padding: 1px; float: left; font-size: 4em; text-align: center; }
    */





    /*.syn-path li { margin: 3px 3px 3px 10px; padding: 1px; float: left; width: 100px; height: 90px; font-size: 4em; text-align: center; }*/
    

    .structure
    {
      cursor: pointer;
      width: 100px;
      height: 100px;
      border-radius: 20px;

    }
    

    
    .Key
    {
        border: 2px dotted #ff0000;
        visibility: hidden;
    }

    .ResultMark
    {
      width: 48px;
      height: 48px;
      background-repeat: no-repeat;
    }
    .Correct
    {
      background-image: url(../styles/images/good.png);
    }
    .Wrong
    {
      background-image: url(../styles/images/error.png);
    }
    
    .center {
    display: flex-wrap;
    justify-content: left;
    align-items: center;
    /*border: 1px solid;*/ 
    }











    </style>
    <script src="/tsugi/mod/openochem/js/jquery-3.1.1.min.js"></script>

	<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/tsugi/mod/openochem/js/kekule_libs/dist/themes/default/kekule.css" >	
	<script src="/tsugi/mod/openochem/js/kekule_libs/raphael-min.2.0.1.js"></script>
    <script src="/tsugi/mod/openochem/js/kekule_libs/raphael.export.js"></script>
    <script src="/tsugi/mod/openochem/js/kekule_libs/three.min.js"></script>

    <script src="/tsugi/mod/openochem/js/kekule_libs/dist/kekule.js?modules=widget,chemWidget,io"></script>
	
	
	<script>
	
	   var data = '{"drags":[{"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"coord2D":{"x":13.923666666666666,"y":45.21366666666667,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275489,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275489,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275507,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"},{"coordPos2D":0,"coordPos3D":0,"renderOptions":{"expanded":true,"__type__":"object"},"coord2D":{"x":13.881,"y":45.02166666666667,"__type__":"object"},"charge":0,"parity":null,"ctab":{"nodes":[{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":-0.8000000000000043,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275507,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0.6928203230275507,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":0,"y":0.7999999999999972,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275525,"y":0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"},{"__type__":"Kekule.Atom","coordPos2D":0,"coordPos3D":0,"coord2D":{"x":-0.6928203230275525,"y":-0.3999999999999986,"__type__":"object"},"charge":0,"parity":null,"isotopeId":"C"}],"anchorNodes":[],"connectors":[{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[0,1]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[1,2]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[2,3]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[3,4]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"bondType":"covalent","bondOrder":2,"electronCount":4,"isInAromaticRing":false,"connectedObjs":[4,5]},{"__type__":"Kekule.Bond","coordPos2D":0,"coordPos3D":0,"parity":null,"bondType":"covalent","bondOrder":1,"electronCount":2,"isInAromaticRing":false,"connectedObjs":[5,0]}],"__type__":"Kekule.StructureConnectionTable"},"__type__":"Kekule.Molecule"}],"drops":[{"top":141,"left":56},{"top":133,"left":292}]}';
	
	
	
	</script>
	
	
	<script>
	
$( document).ready(function() {
	//console.log("INITED");	
		
		
    //$( ".dropable-span" ).draggable();	
		
		
		
		
    var viewerAnswerIds = ['viewerProduct1'];
    
    
    function prepareDropableViewer(id, hidecntrls=false, editbtn=true, deletebtn=true)
    {
    
    var viewerId = id;
    var viewer = new Kekule.ChemWidget.Viewer(document.getElementById(viewerId));
    

			viewer
			.setEnableEdit(false)
			.setEnableToolbar(false)
			.setEnableDirectInteraction(false)
			.setToolButtons(['openEditor',
				  {
				    'text': 'Custom',  // button caption
				    'htmlClass': 'K-Widget-Grid-Button-Remove',  // show a OK icon
				    'showText': false,   // display caption of button
				    '#execute': function(){ deleteViewer(viewerId); }  // event handler when executing the button
				  }
		     ]);
		 
             
		                 
		 //set options for editor
	     var renderConfigs = new Kekule.Render.Render2DConfigs();
	     renderConfigs.getColorConfigs().setUseAtomSpecifiedColor(true);
	     renderConfigs.getMoleculeDisplayConfigs().setDefChargeMarkType(3);
	     viewer.setEditorProperties({'renderConfigs': renderConfigs});
	     
	     
	     var vrenderConfigs = viewer.getRenderConfigs();
	     vrenderConfigs.getColorConfigs().setUseAtomSpecifiedColor(true);
	     vrenderConfigs.getMoleculeDisplayConfigs().setDefChargeMarkType(3);
		 
	     var BNS = Kekule.ChemWidget.ComponentWidgetNames;
		  
		  
		 /* 
         viewer.setEditorProperties({
                  'commonToolButtons': [BNS.newDoc, BNS.undo, BNS.redo, BNS.copy, BNS.cut, BNS.paste,
                BNS.zoomIn, BNS.zoomOut], 
                          'chemToolButtons': [
                  BNS.manipulate,
                  BNS.erase,
                  {'name': 'Custom', 'actionClass': Kekule.Editor.ActionOnComposerAdv,
                    'text': 'Create', 'hint': 'Add atoms and bonds', 'id': 'btnMyCreate', 'htmlClass': 'MYBUTTON',
                    'widget': Kekule.Widget.RadioButton,
                    'attached': [
                    BNS.molRepMethane, BNS.molBondSingle, BNS.molBondDouble, BNS.molBondTriple, BNS.molBondWedgeUp, BNS.molBondWedgeDown,
                    BNS.molAtom
                  ]},
                  BNS.molRing,
                  {
                    'name': BNS.molCharge,
                    'attached': [
                      BNS.molChargeClear,
                      BNS.molChargePositive,
                      BNS.molChargeNegative,
                      BNS.molElectronLonePair,
                      BNS.molRadicalDoublet
                    ]
                  }
                ]
                 });
                 
           */      
                 
                 
        var mol = new Kekule.Molecule();

        viewer.setChemObj(mol);
		                 
    
     
    };
    
    /*
    function addDropStructure()
    {
        var d = new Date();
        var uid = d.valueOf();
    
	    $("#dd-dropable").append('<span draggable="true" class="dragable-span" style="width:150px;height:150px"  id="viewerProduct'+uid+'" data-widget="Kekule.ChemWidget.Viewer2D" data-predefined-setting="editOnly" data-autofit="true"></span>');
	
		$("#img-container").append('<span  class="dropable-span"></span>');
		

		
		
		
		
		$( ".dropable-span" ).draggable({
		
		  start: function() {
          //counts[ 0 ]++;
          //updateCounterStatus( $start_counter, counts[ 0 ] );
          },
          drag: function() {
            //counts[ 1 ]++;
            //updateCounterStatus( $drag_counter, counts[ 1 ] );
          },
          stop: function(e) {
          
            console.log(e);
            console.log(e.target.id);
            //counts[ 2 ]++;
            //updateCounterStatus( $stop_counter, counts[ 2 ] );

            
            
          }
		
		
		});
	
    //function prepareViewer(id, type, hidecntrls=false, editbtn=true, deletebtn=true)	
	prepareDropableViewer("viewerProduct"+uid, "structure", false);

    }
    */


    /*
    function deleteViewer(id)
    {

      $( "#"+id ).remove();
      
    };
    */
    
    
    function randomString(length) {
        var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz'.split('');

        if (! length) {
            length = Math.floor(Math.random() * chars.length);
        }

        var str = '';
        for (var i = 0; i < length; i++) {
            str += chars[Math.floor(Math.random() * chars.length)];
        }
        return str;
    }
    


    function addStructureKjs(kjs, hidecntrls=false, editbtn=true, deletebtn=true)
    {
        //console.log(kjs);
        var d = new Date();
        var uid = d.valueOf();
        var providedstyle = editbtn ? 'syn_notprovided' : 'syn_provided';
        //if (editbtn)
        
	    $("#dd-dropable").append('<span draggable="true" class="dragable-span"  style="width: 100px; height: 100px" id="viewerProduct'+uid+'" data-widget="Kekule.ChemWidget.Viewer2D" data-predefined-setting="editOnly" ><span>');
	    

        $( ".dragable-span" ).draggable({
              revert: true,
              drop: function( event, ui ) {
                    console.log("droped");
                }
        });


	    var id="viewerProduct"+uid
	    prepareDropableViewer(id, hidecntrls, editbtn, deletebtn);
        //console.log(kjs);
	    loadKjs(kjs, id);
    }



    function loadKjs(kjs, viewerid)
    {
       var viewer = Kekule.Widget.getWidgetById(viewerid);
       
       //console.log(typeof kjs);
       if (kjs) {
       //console.log("made it");
       var molecule = Kekule.IO.loadFormatData(kjs, 'Kekule-JSON');
	   viewer.setChemObj(molecule)
       }
    }



		
    function init()
    {
         
         
             
         var readdata = JSON.parse(data);
             
         for (let i = 0; i < readdata.drops.length; i++) {
            console.log(readdata.drops[i]);
            //text += cars[i] + "<br>";
            $("#img-container").append('<span style="left:'+readdata.drops[i].left+'px; top:'+readdata.drops[i].top+'px" class="dropable-span"></span>');
            //$("#img-container").append('<span>', {'style': {'left': readdata.drops[i].left, 'top': readdata.drops[i].top}});
            
            $( ".dropable-span" ).droppable({
                  drop: function( event, ui ) {
                        console.log("droped");
                        console.log(ui.draggable);
                        console.log(event.target);
                         
                        console.log(ui);
                        
                        var dropped = ui.draggable;
                        var droppedOn = $(this);
                        $(dropped).detach().css({top: 0,left: 0}).appendTo(droppedOn);
                        
                        
                        
                        
                    }
            });
            
            
            
         
         }
         
         
         for (let i = 0; i < readdata.drags.length; i++) {
            console.log(readdata.drags[i]);
            
            
            addStructureKjs(JSON.stringify(readdata.drags[i]), hidecntrls=false, editbtn=true, deletebtn=true);
            
            //prepareDropableViewer("viewerProduct"+uid, "structure", false);

         
         }
         


        
    }
    
        init();
  
  
  
  $("#save").click(function(){


       console.log("Save");
       var drops = [];
       $('.dropable-span').each(function( index, value ) {
            console.log($(this).position());
            drops.push($(this).position());
            
       
       });
   
   
       var drags = [];
       $('.dragable-span').each(function( index, value ) {
            console.log(this.id);
            //var chemViewer = new Kekule.ChemWidget.Viewer(document.getElementById(this.id));
            
            var viewer = Kekule.Widget.getWidgetById(this.id);
	        var molecule = viewer.getChemObj();
			var kjs = Kekule.IO.saveFormatData(molecule, 'Kekule-JSON');
            //console.log(kjs);
            drags.push(kjs);
            
       
       });
   
       console.log(drags);
       console.log(drops);
   

});
  
  
  
    
});







</script>




<body>

    <div id="img-container" >

    <img id="bgimage" src = "monosubstituted_arenes.png" />
    </div>

    <div id="dd-dropable" class="center">

    </div>


    <div class="btn-group btn-group-sm" role="group" aria-label="...">
    
    <button class="btn btn-default" id="save">Save</button>
    </div>
</body>
</html>


